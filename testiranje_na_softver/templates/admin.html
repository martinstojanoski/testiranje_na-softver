{% extends "base.html" %}
{% block title %}Admin Panel{% endblock %}

{% block content %}
<style>
  :root{
    --bg:#070708;
    --glass: rgba(20,20,22,.58);
    --glass2: rgba(20,20,22,.42);
    --stroke: rgba(255,215,0,.18);
    --stroke2: rgba(255,255,255,.10);
    --gold:#ffd700;
    --gold2:#c9a200;
    --text:#f2f2f2;
    --muted:#b9b9b9;
    --danger:#ff4d4d;
    --ok:#4dff8b;
    --vio:#bb86fc;
    --shadow: 0 26px 70px rgba(0,0,0,.86);
    --shadow2: 0 18px 45px rgba(0,0,0,.70);
  }

  body{
    background:
      radial-gradient(900px 520px at 20% 0%, rgba(255,215,0,.10), transparent 60%),
      radial-gradient(700px 420px at 80% 15%, rgba(187,134,252,.11), transparent 55%),
      radial-gradient(circle at top, #171717, #0b0b0c 55%, #070708);
    color: var(--text);
    font-family: "Segoe UI", system-ui, -apple-system, Arial, sans-serif;
    overflow-x:hidden;
  }

  /* cinematic grain */
  .grain{
    position:fixed; inset:0; z-index:0; pointer-events:none;
    opacity:.06;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='140' height='140'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='140' height='140' filter='url(%23n)' opacity='.35'/%3E%3C/svg%3E");
    mix-blend-mode: overlay;
  }

  /* particles */
  .bg-particles{ position:fixed; inset:0; pointer-events:none; z-index:0; opacity:.55; }
  .p{
    position:absolute; width:6px; height:6px; border-radius:999px;
    background: radial-gradient(circle, rgba(255,215,0,.9), rgba(255,215,0,.05));
    animation: float 10s ease-in-out infinite;
    filter: blur(.15px);
  }
  .p:nth-child(1){ left:8%; top:18%; animation-duration:10s; transform: scale(.8); }
  .p:nth-child(2){ left:18%; top:74%; animation-duration:11s; transform: scale(.6); }
  .p:nth-child(3){ left:62%; top:14%; animation-duration:12s; transform: scale(.7); }
  .p:nth-child(4){ left:86%; top:60%; animation-duration:13s; transform: scale(.9); }
  .p:nth-child(5){ left:50%; top:82%; animation-duration:14s; transform: scale(.55); }
  @keyframes float{
    0%,100%{ transform: translateY(0) translateX(0); opacity:.55; }
    50%{ transform: translateY(-18px) translateX(10px); opacity:.9; }
  }

  /* layout */
  .wrap{
    position:relative; z-index:1;
    min-height: calc(100vh - 160px);
    display:flex; align-items:center; justify-content:center;
    padding: 72px 14px;
  }
  .shell{
    width:100%;
    max-width: 1180px;
    display:grid;
    grid-template-columns: 1.1fr .9fr;
    gap: 22px;
    align-items: stretch;
  }

  /* left brand panel */
  .brand{
    border-radius: 30px;
    background:
      linear-gradient(145deg, rgba(255,215,0,.10), rgba(0,0,0,0) 35%),
      linear-gradient(145deg, #151516, #0e0e10);
    border: 1px solid rgba(255,215,0,.16);
    box-shadow: 0 26px 70px rgba(0,0,0,.80);
    padding: 38px;
    overflow:hidden;
    position: relative;
    animation: inUp 650ms ease both;
  }
  .brand::before{
    content:"";
    position:absolute;
    inset:-160px -200px auto auto;
    width: 560px; height: 560px;
    background: radial-gradient(circle, rgba(255,215,0,.22), transparent 62%);
    transform: rotate(15deg);
    pointer-events:none;
  }
  .brand::after{
    content:"";
    position:absolute;
    inset:auto -120px -140px auto;
    width: 360px; height: 360px;
    background: radial-gradient(circle, rgba(187,134,252,.16), transparent 62%);
    pointer-events:none;
  }

  .brand-top{ display:flex; align-items:center; gap:14px; margin-bottom: 18px; }
  .logo{
    width: 80px; height: 80px;
    border-radius: 22px;
    background: rgba(0,0,0,.25);
    border: 1px solid rgba(255,215,0,.22);
    display:flex; align-items:center; justify-content:center;
    position:relative; overflow:hidden;
    animation: pop 900ms ease-out both;
  }
  .logo img{ width: 58px; height:auto; }
  .logo::after{
    content:"";
    position:absolute; inset:-44px;
    background: linear-gradient(120deg, transparent 35%, rgba(255,215,0,.26) 50%, transparent 65%);
    transform: translateX(-60%) rotate(10deg);
    animation: shine 2.7s ease-in-out infinite;
    pointer-events:none;
  }
  @keyframes shine{
    0%{ transform: translateX(-75%) rotate(10deg); opacity:.22; }
    35%{ opacity:.92; }
    100%{ transform: translateX(75%) rotate(10deg); opacity:.22; }
  }
  @keyframes pop{
    0%{ transform: scale(.75); opacity:0; }
    70%{ transform: scale(1.06); opacity:1; }
    100%{ transform: scale(1); }
  }

  .brand-title h1{
    margin:0;
    font-size: 22px;
    letter-spacing: 1.2px;
    color: var(--gold);
  }
  .brand-title p{
    margin:6px 0 0 0;
    color: var(--muted);
    font-size: 13.5px;
    line-height: 1.45;
  }

  .features{ margin-top: 18px; display:grid; gap: 10px; }
  .feat{
    display:flex; gap:10px; align-items:flex-start;
    padding: 14px 14px;
    border-radius: 18px;
    background: rgba(255,255,255,.03);
    border: 1px solid rgba(255,215,0,.10);
  }
  .dot{
    width: 10px; height: 10px;
    border-radius: 999px;
    margin-top: 4px;
    background: radial-gradient(circle, rgba(255,215,0,1), rgba(255,215,0,.15));
    box-shadow: 0 0 18px rgba(255,215,0,.28);
    flex: 0 0 auto;
  }
  .feat b{ color:#f7f2d3; font-weight: 900; display:block; margin-bottom: 2px; }
  .feat span{ color:#cfcfcf; font-size: 13px; line-height: 1.45; }

  /* RIGHT: premium frame */
  .frame{
    border-radius: 30px;
    padding: 1px;
    background: linear-gradient(135deg, rgba(255,215,0,.38), rgba(187,134,252,.24), rgba(255,255,255,.10));
    box-shadow: var(--shadow);
    position: relative;
    overflow:hidden;
    animation: inUp 780ms ease both;
    transform-style: preserve-3d;
  }
  .frame::before{
    content:"";
    position:absolute;
    inset:-80px;
    background: conic-gradient(from 180deg,
      rgba(255,215,0,.0),
      rgba(255,215,0,.35),
      rgba(187,134,252,.28),
      rgba(255,255,255,.12),
      rgba(255,215,0,.0)
    );
    filter: blur(26px);
    opacity:.55;
    animation: orbit 7.5s linear infinite;
    pointer-events:none;
  }
  @keyframes orbit{ to{ transform: rotate(360deg); } }

  .card{
    border-radius: 30px;
    background: var(--glass);
    border: 1px solid rgba(255,255,255,.06);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    padding: 32px 28px;
    position: relative;
    overflow:hidden;
  }
  .card::after{
    content:"";
    position:absolute;
    inset:-60px -140px auto auto;
    width: 360px; height: 360px;
    background: linear-gradient(120deg, transparent 35%, rgba(255,215,0,.10) 50%, transparent 65%);
    transform: translateX(-30%) rotate(12deg);
    opacity:.55;
    animation: sweep 3.8s ease-in-out infinite;
    pointer-events:none;
  }
  @keyframes sweep{
    0%{ transform: translateX(-40%) rotate(12deg); opacity:.25; }
    45%{ opacity:.85; }
    100%{ transform: translateX(40%) rotate(12deg); opacity:.25; }
  }

  .head{ margin-bottom: 14px; position:relative; z-index:1; }
  .head h2{ margin:0; font-size: 22px; letter-spacing:.6px; color:#fff; }
  .head p{ margin:8px 0 0; color: var(--muted); font-size: 13.5px; }

  /* flash */
  .flash{
    position:relative; z-index:1;
    padding: 12px;
    margin: 14px 0 14px;
    border-radius: 14px;
    font-size: 14px;
    text-align:center;
    border-left: 4px solid transparent;
    background: rgba(255,255,255,.04);
  }
  .flash.success{ border-left-color: var(--ok); color:#d8ffe5; background: rgba(30,95,43,.35); }
  .flash.error{ border-left-color: var(--danger); color:#ffd0d0; background: rgba(59,29,29,.55); }
  .flash.info{ border-left-color: var(--vio); color:#e5d4ff; background: rgba(43,29,59,.55); }

  /* form grid */
  .grid{
    position:relative; z-index:1;
    display:grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
  }

  /* floating label fields */
  .field{ margin-top: 12px; position:relative; z-index:1; }
  .control{
    position: relative;
    border-radius: 18px;
    background: rgba(0,0,0,.25);
    border: 1px solid rgba(255,255,255,.10);
    transition: .22s;
  }
  .control:focus-within{
    border-color: rgba(255,215,0,.55);
    box-shadow: 0 0 0 4px rgba(255,215,0,.10);
    background: rgba(0,0,0,.34);
  }
  .control input{
    width:100%;
    padding: 18px 46px 10px 14px;
    border: none;
    background: transparent;
    color:#fff;
    font-size: 15px;
    outline:none;
    border-radius: 18px;
  }
  .control label{
    position:absolute;
    left: 14px;
    top: 13px;
    font-size: 13px;
    font-weight: 900;
    color: rgba(255,255,255,.70);
    pointer-events:none;
    transition: .18s;
  }
  .control input:focus + label,
  .control input:not(:placeholder-shown) + label{
    top: 7px;
    font-size: 11px;
    color: rgba(255,215,0,.92);
    letter-spacing: .25px;
  }

  .icon{
    position:absolute;
    right: 10px;
    top: 50%;
    transform: translateY(-50%);
    width: 34px; height: 34px;
    border-radius: 12px;
    border: 1px solid rgba(255,215,0,.18);
    background: rgba(255,215,0,.08);
    color: var(--gold);
    display:flex; align-items:center; justify-content:center;
    user-select:none;
  }

  /* button */
  .btn{
    position:relative; z-index:1;
    width: 100%;
    margin-top: 16px;
    padding: 14px;
    border: none;
    border-radius: 18px;
    background: linear-gradient(135deg, var(--gold), var(--gold2));
    color: #151515;
    font-size: 16px;
    font-weight: 950;
    cursor:pointer;
    letter-spacing: .7px;
    transition:.25s;
    box-shadow: 0 12px 30px rgba(255,215,0,.20);
    display:flex;
    align-items:center;
    justify-content:center;
    gap: 10px;
  }
  .btn:hover{
    transform: translateY(-2px);
    box-shadow: 0 18px 42px rgba(255,215,0,.28);
    background: linear-gradient(135deg, #ffe44d, #d4b200);
  }

  .btn.secondary{
    background: rgba(0,0,0,.22);
    color: var(--text);
    border: 1px solid rgba(255,215,0,.18);
    box-shadow: none;
  }
  .btn.secondary:hover{
    border-color: rgba(255,215,0,.35);
    box-shadow: 0 16px 34px rgba(0,0,0,.40);
    transform: translateY(-2px);
  }

  /* tables */
  .section-title{
    position:relative; z-index:1;
    margin: 18px 0 10px;
    font-size: 14.5px;
    letter-spacing: .4px;
    color:#fff;
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap: 10px;
  }
  .table-wrap{
    position:relative; z-index:1;
    margin-top: 10px;
    border-radius: 18px;
    background: rgba(0,0,0,.20);
    border: 1px solid rgba(255,255,255,.10);
    overflow:hidden;
    box-shadow: var(--shadow2);
  }
  table{
    width:100%;
    border-collapse: collapse;
  }
  thead th{
    text-align:left;
    padding: 12px 14px;
    font-size: 12.5px;
    letter-spacing: .35px;
    color: rgba(255,255,255,.86);
    background: rgba(255,255,255,.04);
    border-bottom: 1px solid rgba(255,255,255,.08);
  }
  tbody td{
    padding: 12px 14px;
    border-bottom: 1px solid rgba(255,255,255,.06);
    color: rgba(255,255,255,.86);
    font-size: 13.5px;
  }
  tbody tr:hover{
    background: rgba(255,215,0,.06);
  }
  .pill{
    display:inline-flex;
    align-items:center;
    gap: 8px;
    padding: 8px 10px;
    border-radius: 999px;
    background: rgba(0,0,0,.22);
    border: 1px solid rgba(255,215,0,.18);
    color:#eaeaea;
    font-size: 12.5px;
    white-space: nowrap;
  }
  .pill b{ color: var(--gold); }

  .two{
    margin-top: 14px;
    display:grid;
    grid-template-columns: 1fr;
    gap: 14px;
  }

  @keyframes inUp{ from{ opacity:0; transform: translateY(16px);} to{ opacity:1; transform: translateY(0);} }

  @media(max-width: 980px){
    .shell{ grid-template-columns: 1fr; max-width: 640px; }
    .brand{ display:none; }
    .wrap{ padding: 60px 14px; }
    .grid{ grid-template-columns: 1fr; }
  }
</style>

<div class="grain" aria-hidden="true"></div>
<div class="bg-particles" aria-hidden="true">
  <span class="p"></span><span class="p"></span><span class="p"></span><span class="p"></span><span class="p"></span>
</div>

<div class="wrap">
  <div class="shell">

    <!-- LEFT -->
    <section class="brand">
      <div class="brand-top">
        <div class="logo">
          <img src="{{ url_for('static', filename='images/logo.png') }}" alt="HOTEL BUFF">
        </div>
        <div class="brand-title">
          <h1>HOTEL BUFF</h1>
          <p>Admin panel for registering guests and monitoring all current stays ‚Äî premium and controlled.</p>
        </div>
      </div>

      <div class="features">
        <div class="feat"><span class="dot"></span><div><b>Register Guests</b><span>Create bookings with check-in/check-out dates quickly.</span></div></div>
        <div class="feat"><span class="dot"></span><div><b>Track Stays</b><span>See all guests and identify who is currently active.</span></div></div>
        <div class="feat"><span class="dot"></span><div><b>Admin Tools</b><span>Jump to full bookings list and manage system data.</span></div></div>
      </div>
    </section>

    <!-- RIGHT -->
    <section class="frame" id="tiltFrame">
      <div class="card">
        <div class="head">
          <h2>Admin Panel</h2>
          <p>Register guest and review current/total guests in a premium dashboard.</p>
        </div>

        {% if message %}
          <div class="flash success">{{ message }}</div>
        {% endif %}

        {% with messages = get_flashed_messages(with_categories=True) %}
          {% if messages %}
            {% for category, msg in messages %}
              <div class="flash {{ category }}">{{ msg }}</div>
            {% endfor %}
          {% endif %}
        {% endwith %}

        <form method="POST" autocomplete="on">

          <div class="grid">
            <div class="field">
              <div class="control">
                <input id="first_name" type="text" name="first_name" required placeholder=" " />
                <label for="first_name">First Name</label>
                <div class="icon">üßë</div>
              </div>
            </div>

            <div class="field">
              <div class="control">
                <input id="last_name" type="text" name="last_name" required placeholder=" " />
                <label for="last_name">Last Name</label>
                <div class="icon">üßë</div>
              </div>
            </div>
          </div>

          <!-- ‚úÖ REPLACED: Passport -> Email + Phone (everything else unchanged) -->
          <div class="grid">
            <div class="field">
              <div class="control">
                <input id="email" type="email" name="email" required placeholder=" " />
                <label for="email">Email Address</label>
                <div class="icon">üìß</div>
              </div>
            </div>

            <div class="field">
              <div class="control">
                <input id="phone" type="tel" name="phone" required placeholder=" " />
                <label for="phone">Phone Number</label>
                <div class="icon">üìû</div>
              </div>
            </div>
          </div>

          <div class="grid">
            <div class="field">
              <div class="control">
                <input id="check_in" type="date" name="check_in" required placeholder=" " />
                <label for="check_in">Check-in Date</label>
                <div class="icon">üìÖ</div>
              </div>
            </div>

            <div class="field">
              <div class="control">
                <input id="check_out" type="date" name="check_out" required placeholder=" " />
                <label for="check_out">Check-out Date</label>
                <div class="icon">üèÅ</div>
              </div>
            </div>
          </div>

          <button class="btn" type="submit">‚úÖ Register Guest</button>

          <div style="margin-top:12px; display:flex; gap:10px; flex-wrap:wrap; position:relative; z-index:1;">
            <a class="btn secondary" href="{{ url_for('admin_bookings') }}">üìã View Registered Guests</a>
            <a class="btn secondary" href="{{ url_for('home') }}">üè† Back to Home</a>
          </div>
        </form>

        <div class="two">

          <div>
            <div class="section-title">
              <span>All Guests</span>
              <span class="pill">Total: <b>{{ guests|length }}</b></span>
            </div>

            <div class="table-wrap">
              <table>
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Phone</th>
                    <th>Check-in</th>
                    <th>Check-out</th>
                  </tr>
                </thead>
                <tbody>
                  {% for g in guests %}
                  <tr>
                    <td>{{ g.first_name }} {{ g.last_name }}</td>
                    <td>{{ g.email }}</td>
                    <td>{{ g.phone }}</td>
                    <td>{{ g.check_in }}</td>
                    <td>{{ g.check_out }}</td>
                  </tr>
                  {% else %}
                  <tr>
                    <td colspan="5" style="color: rgba(255,255,255,.6); padding: 14px;">
                      No guests registered yet.
                    </td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>

          <div>
            <div class="section-title">
              <span>Current Guests</span>
              <span class="pill">Active: <b>{{ current_guests|length }}</b></span>
            </div>

            <div class="table-wrap">
              <table>
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Phone</th>
                    <th>Check-in</th>
                    <th>Check-out</th>
                  </tr>
                </thead>
                <tbody>
                  {% for g in current_guests %}
                  <tr>
                    <td>{{ g.first_name }} {{ g.last_name }}</td>
                    <td>{{ g.email }}</td>
                    <td>{{ g.phone }}</td>
                    <td>{{ g.check_in }}</td>
                    <td>{{ g.check_out }}</td>
                  </tr>
                  {% else %}
                  <tr>
                    <td colspan="5" style="color: rgba(255,255,255,.6); padding: 14px;">
                      No current guests right now.
                    </td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>

        </div>

      </div>
    </section>

  </div>
</div>

<script>
  (function(){
    // ultra subtle tilt (desktop only)
    const frame = document.getElementById("tiltFrame");
    if(frame && window.matchMedia("(min-width: 981px)").matches){
      frame.addEventListener("mousemove", (e) => {
        const r = frame.getBoundingClientRect();
        const x = (e.clientX - r.left) / r.width - 0.5;
        const y = (e.clientY - r.top) / r.height - 0.5;
        const rx = (-y * 4).toFixed(2);
        const ry = (x * 6).toFixed(2);
        frame.style.transform = `rotateX(${rx}deg) rotateY(${ry}deg)`;
      });
      frame.addEventListener("mouseleave", () => {
        frame.style.transform = "rotateX(0deg) rotateY(0deg)";
      });
    }
  })();
</script>
{% endblock %}
